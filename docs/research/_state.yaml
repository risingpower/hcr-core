# Research State
# Machine-readable current state for session continuity
#
# Update this at session end and read at session start.

version: "1.0"
last_updated: "2026-02-13"
last_session: "2026-02-13"

# Current focus
current:
  phase: "research"  # discovery | research | implementation | validation
  focus: "RB-005 complete. Comprehensive failure mode analysis: 26 failure modes identified, 10-20% expected overall failure rate, no showstopper. Three design changes needed: beam diversity enforcement, collapsed-tree as co-primary, external source handling. RB-006 (benchmark design) is next — final brief before go/no-go."
  blockers: []

# Research briefs status
briefs:
  active:
    - id: "RB-006"
      title: "Benchmark design"
      status: "pending"
      assigned_to: "unassigned"
      notes: "Final brief before go/no-go. Must include: per-level routing accuracy as first-class metric, cross-branch sub-type coverage, beam-search vs collapsed-tree comparison, budget-impossible query detection, entity cross-link quality metrics."
  completed:
    - id: "RB-001"
      title: "Prior art survey"
      completed: "2026-02-13"
      key_finding: "12+ systems in the space since 2024. Hierarchical retrieval outperforms flat RAG on complex tasks (2-20pp gains). LATTICE is closest to HCR. No system targets hard token budgets. RAPTOR collapsed-tree result challenges strict top-down traversal."
    - id: "RB-002"
      title: "Theoretical basis: elimination vs similarity"
      completed: "2026-02-13"
      key_finding: "Strict top-down elimination is theoretically fragile — error compounds as (1-ε)^d. RAPTOR collapsed-tree result is structurally predicted, not anomalous. Hybrid coarse-to-fine (shallow elimination + flat search within survivors) is theoretically optimal. H1 needs reframing from 'elimination > similarity' to 'hierarchical coarse-to-fine with token budgets > flat retrieval'."
    - id: "RB-003"
      title: "Scoring mechanics"
      completed: "2026-02-13"
      key_finding: "Cascade architecture (hybrid BM25+dense → cross-encoder) achieves ε ≈ 0.01–0.02 per level at ~40–80ms. Strict admissibility impossible for semantic relevance. Path-relevance EMA is higher leverage than per-node scoring. Summary quality is #1 upstream factor. AdaGReS submodular knapsack for token-budget selection. H1c → 75%."
    - id: "RB-004"
      title: "Tree construction"
      completed: "2026-02-13"
      key_finding: "Four-source convergence on construction recipe: top-down divisive clustering (bisecting k-means, d=2–3, b∈[6,15]) + LLM contrastive routing summaries + soft assignment (1–3 parents per leaf). Routing summaries are a distinct artifact class: {theme, includes, excludes, key_entities, key_terms}. Gemini adds Q-STRUM Debate for adversarial contrastive generation, depth-variable summary formatting (contrastive prose at L1, keyword arrays + multi-vector at L2), Schema Entropy Bound and Sibling Distinctiveness (BM25 softmax) as concrete tree quality metrics, and EraRAG LSH hyperplanes as alternative partitioning with deterministic incremental maintenance. Cross-branch defense requires five layers. No routing-specific tree quality metric in literature — genuine research gap. H1b → 80%."
    - id: "RB-005"
      title: "Failure modes"
      completed: "2026-02-13"
      key_finding: "No architectural showstopper. 26 failure modes identified across all pipeline stages. Overall expected failure rate: 10–20%. Top residual risks: (1) DPI information loss for detail queries, (2) budget impossibility for aggregation/listing queries, (3) beam collapse without diversity enforcement. Three design changes needed: beam diversity, collapsed-tree as co-primary, external source handling. Entity cross-links elevated to primary mechanism for dominant query type (entity-centric). Transition period (small corpus) is highest-risk deployment phase."

# Hypothesis summary
hypotheses:
  total: 3
  validated: 0
  invalidated: 0
  uncertain: 3
  retired: 1  # Original H1
  highest_confidence: "H1b (hybrid coarse-to-fine superiority) at 80%"
  lowest_confidence: "H1a (token efficiency) at 65%"
  notes: "RB-005 failure analysis reinforces H1b (hybrid architecture confirmed by all three sources). H1c mechanism broadened — entity cross-link quality is at least as important as per-level scoring quality for the dominant query type (entity-spanning). H1a scoped by budget impossibility class: 400-token constraint creates ~5-20% structurally unanswerable queries. No confidence changes — RB-006 needed for empirical validation."

# Knowledge accumulation
knowledge:
  patterns_discovered: 0
  variants_discovered: 0
  contexts_documented: 0
  domains_documented: 0
  edge_cases: 0

# Next actions (prioritized)
next_actions:
  - "Scaffold and write RB-006 prompt (benchmark design — final brief before go/no-go)"
  - "JC runs RB-006 prompt across sources"
  - "Consolidate RB-006 responses"
  - "Go/no-go decision on Phase 1"
  - "Add Gemini responses to RB-001/RB-002/RB-003/RB-004/RB-005 if/when available"

# Notes for next session
notes: "RB-005 consolidation complete. Three-source consensus: no showstopper, 10-20% overall failure rate, bounded and diagnosable. Key new insights: (1) token-budget impossibility is orthogonal to routing quality — aggregation/listing queries cannot be answered in 400 tokens regardless of retrieval, (2) entity cross-links are more critical than routing summaries for the dominant query type (entity-centric, 40-55% of enterprise queries), (3) collapsed-tree should be co-primary not fallback (RAPTOR evidence), (4) beam collapse is a design gap needing diversity enforcement. Three design changes recommended before Phase 1: beam diversity, collapsed co-primary, external source handling. RB-006 is the final gate."
